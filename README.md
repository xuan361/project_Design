## **保持main分支，与最新发行版Releases一致，**

## **dev应该是最新进展的最新开发记录**

## **为实现可视化窗口，另开windows分支作为最新进展**


```
pseudo.py从program.txt中读取汇编语言并进行汇编，再输入到machine_code_output.txt
而用windows.py实现可视化操作窗口
```

pseudo.py不能直接单独使用，

若想单独使用pseudo.py及其功能，需要修改pseudo.py的expand_pseudo_instructions(lines)末尾，详见pseudo.py开头注释

若要实现可视化窗口，直接运行windows.py即可

（老汇编代码已移至 /src/old asm 文件夹中）

（开发日志写在Development Log.mdl里面）



# **Guide Manual**

（借助Gemini）

## **自定义ISA的16位RISC处理器模拟器 - 使用说明书**

#### **1. 简介**

欢迎使用这款专为您定制的16位RISC处理器模拟器！本工具提供了一个完整的图形化界面（GUI），旨在帮助您方便地进行以下操作：

- **编写和编辑**您的自定义指令集（ISA）的汇编代码。
- **汇编**代码，将其从人类可读的文本转换为机器可执行的二进制码。
- **单步或连续执行**您的程序，并实时观察效果。
- **调试**程序，通过设置断点、查看寄存器和内存状态来定位和解决问题。

#### **2. 系统需求与准备**

- **环境**: 已安装Python 3.x环境。
- **文件**: 确保主程序 `windows.py` 和汇编器核心库 `pseudo.py` 位于**同一个文件夹**下。
- **代码源**: 确保你的汇编代码源文件（例如 `program.txt`）存在，并且路径在 `windows.py` 中已正确配置（用于程序启动时自动加载）。不在也行，支持手动选址并打开

#### **3. 界面布局概览**

模拟器界面主要分为左右两个部分：

- **左侧面板（代码与控制区）**:
  - **汇编代码区**: 带有行号的文本编辑器，您可以在此编写或加载汇编代码。
  - **控制按钮区**: 包含“导入文件”、“汇编”、“单步”、“执行”、“停止”、“重置”等核心功能按钮。
  - **状态栏**: 位于最下方，用于显示程序当前状态、操作结果或错误信息。
- **右侧面板（状态观察区）**:
  - **寄存器区**: 实时显示所有16个寄存器（`r0`-`r15`）的当前值（同时以十进制和十六进制表示）。对于`a`系列通用寄存器，会特别标注其对应的`r`编号，便于对照。
  - **内存视图**: 一个可交互的内存查看器，您可以指定地址来查看特定内存区域的内容。

#### **4. 功能与使用方法**

**4.1 加载与编辑代码**

- **自动加载**: 程序启动时，会自动尝试从`windows.py`中预设的路径加载汇编代码文件。
- **手动加载**: 点击【**导入文件**】按钮，可以从您的电脑中选择任何一个汇编代码文件（`.asm`, `.s`, `.txt`）加载到代码区。
- **实时编辑**: 您可以直接在“汇编代码区”像使用普通记事本一样编写和修改代码。

**4.2 汇编**

- 点击（`汇编`）按钮，程序会执行以下操作：
  1. 读取当前代码编辑区中的所有文本。
  2. 调用`pseudo.py`的逻辑进行汇编。
  3. 双重逻辑处理
     - **生成外部文件**：它会生成一个 `machine_code_output.txt` 文件，其内容与您**独立运行 `pseudo.py` 时完全一致**（保留了原始的 `+1` 跳转逻辑），便于您与Vivado等硬件仿真结果进行比对。
     - **加载到模拟器**：同时，它会将一份**修正后**（没有 `+1` 跳转问题）的机器码加载到模拟器内部内存中，以确保您在GUI中单步和调试时的行为符合逻辑直觉（例如，循环会正确地跳到第一条指令）。
  4. 汇编成功后，“单步”和“执行”按钮将变为可用。

**4.3 执行与调试**

- **单步执行 (`单步`)**:
  - 每点击一次，模拟器会执行**一条真实**的机器指令，并更新所有状态显示。
  - **注意伪指令**：像 `li` 这样的伪指令在汇编时会被分解成多条真实的机器指令。因此，您可能会发现在一行 `li` 指令上需要点击多次“单步”，黄色高亮条才会移动到下一行源码，这是完全正常的，因为它正在逐一执行底层的真实指令。
- **连续执行 (`执行`)**:
  - 点击后，模拟器会以设定的速度（例如每50毫秒一步）自动连续执行指令。
  - 在执行期间，您可以**自由滚动内存视图**等区域，界面不会卡死。
  - 执行过程会一直持续，直到程序结束、遇到错误、或被用户手动停止。
- **停止 (`停止`)**:
  - 在连续执行期间，点击此按钮可以随时暂停程序的运行。
- **设置/取消断点**:
  - 在左侧的**行号区**用鼠标左键单击任意一个行号，即可在该行设置一个断点，行号旁会出现一个红色的“●”标记。
  - 再次点击同一个位置，即可取消该断点。
  - **断点功能**：在“连续执行”模式下，当程序即将执行到有断点的行时，会自动暂停，并将状态停留在该指令**之前**，便于您检查此时的状态。断点对“单步执行”没有暂停效果。
- **重置 (`重置`)**:
  - 点击后，会将模拟器的所有状态恢复到初始。包括：
    - PC（程序计数器）归零。
    - 所有寄存器清零。
    - 停止任何正在进行的连续执行。
    - **（可选功能）** 根据您的设置，也可以选择在重置时清除所有已设置的断点。

**4.4 状态观察**

- **寄存器区**: 实时反映每次指令执行后寄存器值的变化。
- 内存视图
  - 顶部的输入框允许您输入**十六进制地址**（如 `1000`）。
  - 点击【**跳转**】按钮，视图会刷新并显示从您输入的地址开始的内存内容。
  - 您可以随时单步或连续执行，内存视图会**自动刷新**当前显示区域的内容，让您能实时观察数据的变化（例如`sb`指令的写入结果）

